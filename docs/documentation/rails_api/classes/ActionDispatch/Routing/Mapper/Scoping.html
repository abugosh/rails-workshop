<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>ActionDispatch::Routing::Mapper::Scoping</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="../../../../css/reset.css" type="text/css" media="screen" />
    <link rel="stylesheet" href="../../../../css/main.css" type="text/css" media="screen" />
    <script src="../../../../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../../../js/jquery-effect.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../../../js/main.js" type="text/javascript" charset="utf-8"></script>
</head>

<body>     
    <div class="banner">
        <h1>
            <span class="type">Module</span> 
            ActionDispatch::Routing::Mapper::Scoping 
            
        </h1>
        <ul class="files">
            
            <li><a href="../../../../files/actionpack/lib/action_dispatch/routing/mapper_rb.html">actionpack/lib/action_dispatch/routing/mapper.rb</a></li>
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
    
    <div class="description">
        <p>
You may wish to organize groups of controllers under a namespace. Most
commonly, you might group a number of administrative controllers under an
<tt>admin</tt> namespace. You would place these controllers under the
app/controllers/admin directory, and you can group them together in your
router:
</p>
<pre>
  namespace &quot;admin&quot; do
    resources :posts, :comments
  end
</pre>
<p>
This will create a number of routes for each of the posts and comments
controller. For Admin::PostsController, <a
href="../../../Rails.html">Rails</a> will create:
</p>
<pre>
  GET       /admin/photos
  GET       /admin/photos/new
  POST    /admin/photos
  GET       /admin/photos/1
  GET       /admin/photos/1/edit
  PUT       /admin/photos/1
  DELETE  /admin/photos/1
</pre>
<p>
If you want to route /photos (without the prefix /admin) to
Admin::PostsController, you could use
</p>
<pre>
  scope :module =&gt; &quot;admin&quot; do
    resources :posts, :comments
  end
</pre>
<p>
or, for a single case
</p>
<pre>
  resources :posts, :module =&gt; &quot;admin&quot;
</pre>
<p>
If you want to route /admin/photos to PostsController
</p>
<table>
<tr><td valign="top">(without the Admin:</td><td>module prefix), you could use

</td></tr>
</table>
<pre>
  scope &quot;/admin&quot; do
    resources :posts, :comments
  end
</pre>
<p>
or, for a single case
</p>
<pre>
  resources :posts, :path =&gt; &quot;/admin&quot;
</pre>
<p>
In each of these cases, the named routes remain the same as if you did not
use scope. In the last case, the following paths map to PostsController:
</p>
<pre>
  GET       /admin/photos
  GET       /admin/photos/new
  POST    /admin/photos
  GET       /admin/photos/1
  GET       /admin/photos/1/edit
  PUT       /admin/photos/1
  DELETE  /admin/photos/1
</pre>

    </div>
    

    

    
    

    
    
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
    
        <dt>C</dt>
        <dd>
            <ul>
                
                <li><a href="#M006177">constraints</a>,</li>
                
                <li><a href="#M006175">controller</a></li>
                
            </ul>
        </dd>
    
        <dt>D</dt>
        <dd>
            <ul>
                
                <li><a href="#M006178">defaults</a></li>
                
            </ul>
        </dd>
    
        <dt>N</dt>
        <dd>
            <ul>
                
                <li><a href="#M006176">namespace</a></li>
                
            </ul>
        </dd>
    
        <dt>S</dt>
        <dd>
            <ul>
                
                <li><a href="#M006174">scope</a></li>
                
            </ul>
        </dd>
    
    </dl>
    

    

    

    

    

    

    
            <div class="sectiontitle">Instance Public methods</div>
            
            <div class="method">
                <div class="title" id="M006177">
                    
                    <a name="M006177"></a><b>constraints</b>(constraints = {})
                    
                </div>
                
                <div class="description">
                  <h3>Parameter Restriction</h3>
<p>
Allows you to constrain the nested routes based on a set of rules. For
instance, in order to change the routes to allow for a dot character in the
<tt>id</tt> parameter:
</p>
<pre>
  constraints(:id =&gt; /\d+\.\d+) do
    resources :posts
  end
</pre>
<p>
Now routes such as <tt>/posts/1</tt> will no longer be valid, but
<tt>/posts/1.1</tt> will be. The <tt>id</tt> parameter must match the
constraint passed in for this example.
</p>
<p>
You may use this to also resrict other parameters:
</p>
<pre>
  resources :posts do
    constraints(:post_id =&gt; /\d+\.\d+) do
      resources :comments
    end
</pre>
<h3>Restricting based on IP</h3>
<p>
Routes can also be constrained to an IP or a certain range of IP addresses:
</p>
<pre>
  constraints(:ip =&gt; /192.168.\d+.\d+/) do
    resources :posts
  end
</pre>
<p>
Any user connecting from the 192.168.* range will be able to see this
resource, where as any user connecting outside of this range will be told
there is no such route.
</p>
<h3>Dynamic request matching</h3>
<p>
Requests to routes can be constrained based on specific critera:
</p>
<pre>
   constraints(lambda { |req| req.env[&quot;HTTP_USER_AGENT&quot;] =~ /iPhone/ }) do
     resources :iphones
   end
</pre>
<p>
You are able to move this logic out into a class if it is too complex for
routes. This class must have a <tt>matches?</tt> method defined on it which
either returns <tt>true</tt> if the user should be given access to that
route, or <tt>false</tt> if the user should not.
</p>
<pre>
   class Iphone
     def self.matches(request)
       request.env[&quot;HTTP_USER_AGENT&quot;] =~ /iPhone/
     end
   end
</pre>
<p>
An expected place for this code would be <tt>lib/constraints</tt>.
</p>
<p>
This class is then used like this:
</p>
<pre>
   constraints(Iphone) do
     resources :iphones
   end
</pre>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M006177_source')" id="l_M006177_source">show</a>
                        
                        | <a href="http://github.com/rails/rails/blob/2dc297d0d74c554b9b1da86c0243afcfe95737ab/actionpack/lib/action_dispatch/routing/mapper.rb#L681" target="_blank" class="github_url">on GitHub</a>
                        
                    </p>
                    <div id="M006177_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File actionpack/lib/action_dispatch/routing/mapper.rb, line 681</span>
681:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">constraints</span>(<span class="ruby-identifier">constraints</span> = {})
682:           <span class="ruby-identifier">scope</span>(<span class="ruby-identifier">:constraints</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">constraints</span>) { <span class="ruby-keyword kw">yield</span> }
683:         <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M006175">
                    
                    <a name="M006175"></a><b>controller</b>(controller, options={})
                    
                </div>
                
                <div class="description">
                  <p>
Scopes routes to a specific controller
</p>
<p>
Example:
</p>
<pre>
  controller &quot;food&quot; do
    match &quot;bacon&quot;, :action =&gt; &quot;bacon&quot;
  end
</pre>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M006175_source')" id="l_M006175_source">show</a>
                        
                        | <a href="http://github.com/rails/rails/blob/2dc297d0d74c554b9b1da86c0243afcfe95737ab/actionpack/lib/action_dispatch/routing/mapper.rb#L563" target="_blank" class="github_url">on GitHub</a>
                        
                    </p>
                    <div id="M006175_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File actionpack/lib/action_dispatch/routing/mapper.rb, line 563</span>
563:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">controller</span>(<span class="ruby-identifier">controller</span>, <span class="ruby-identifier">options</span>={})
564:           <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:controller</span>] = <span class="ruby-identifier">controller</span>
565:           <span class="ruby-identifier">scope</span>(<span class="ruby-identifier">options</span>) { <span class="ruby-keyword kw">yield</span> }
566:         <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M006178">
                    
                    <a name="M006178"></a><b>defaults</b>(defaults = {})
                    
                </div>
                
                <div class="description">
                  <p>
Allows you to set default parameters for a route, such as this: defaults
:id => &#8216;home&#8217; do
</p>
<pre>
  match 'scoped_pages/(:id)', :to =&gt; 'pages#show'
</pre>
<p>
end Using this, the <tt>:id</tt> parameter here will default to
&#8216;home&#8217;.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M006178_source')" id="l_M006178_source">show</a>
                        
                        | <a href="http://github.com/rails/rails/blob/2dc297d0d74c554b9b1da86c0243afcfe95737ab/actionpack/lib/action_dispatch/routing/mapper.rb#L690" target="_blank" class="github_url">on GitHub</a>
                        
                    </p>
                    <div id="M006178_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File actionpack/lib/action_dispatch/routing/mapper.rb, line 690</span>
690:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">defaults</span>(<span class="ruby-identifier">defaults</span> = {})
691:           <span class="ruby-identifier">scope</span>(<span class="ruby-identifier">:defaults</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">defaults</span>) { <span class="ruby-keyword kw">yield</span> }
692:         <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M006176">
                    
                    <a name="M006176"></a><b>namespace</b>(path, options = {})
                    
                </div>
                
                <div class="description">
                  <p>
Scopes routes to a specific namespace. For example:
</p>
<pre>
  namespace :admin do
    resources :posts
  end
</pre>
<p>
This generates the following routes:
</p>
<pre>
      admin_posts GET    /admin/posts(.:format)          {:action=&gt;&quot;index&quot;, :controller=&gt;&quot;admin/posts&quot;}
      admin_posts POST   /admin/posts(.:format)          {:action=&gt;&quot;create&quot;, :controller=&gt;&quot;admin/posts&quot;}
   new_admin_post GET    /admin/posts/new(.:format)      {:action=&gt;&quot;new&quot;, :controller=&gt;&quot;admin/posts&quot;}
  edit_admin_post GET    /admin/posts/:id/edit(.:format) {:action=&gt;&quot;edit&quot;, :controller=&gt;&quot;admin/posts&quot;}
       admin_post GET    /admin/posts/:id(.:format)      {:action=&gt;&quot;show&quot;, :controller=&gt;&quot;admin/posts&quot;}
       admin_post PUT    /admin/posts/:id(.:format)      {:action=&gt;&quot;update&quot;, :controller=&gt;&quot;admin/posts&quot;}
       admin_post DELETE /admin/posts/:id(.:format)      {:action=&gt;&quot;destroy&quot;, :controller=&gt;&quot;admin/posts&quot;}
</pre>
<h3>Supported options</h3>
<p>
The <tt>:path</tt>, <tt>:as</tt>, <tt>:module</tt>, <tt>:shallow_path</tt>
and <tt>:shallow_prefix</tt> options all default to the name of the
namespace.
</p>
<dl>
<dt>:path</dt><dd>The path prefix for the routes.

<pre>
  namespace :admin, :path =&gt; &quot;sekret&quot; do
    resources :posts
  end
</pre>
<p>
All routes for the above <tt>resources</tt> will be accessible through
<tt>/sekret/posts</tt>, rather than <tt>/admin/posts</tt>
</p>
</dd>
<dt>:module</dt><dd>The namespace for the controllers.

<pre>
  namespace :admin, :module =&gt; &quot;sekret&quot; do
    resources :posts
  end
</pre>
<p>
The <tt>PostsController</tt> here should go in the <tt>Sekret</tt>
namespace and so it should be defined like this:
</p>
<pre>
  class Sekret::PostsController &lt; ApplicationController
    # code go here
  end
</pre>
</dd>
<dt>:as</dt><dd>Changes the name used in routing helpers for this namespace.

<pre>
  namespace :admin, :as =&gt; &quot;sekret&quot; do
    resources :posts
  end
</pre>
</dd>
</dl>
<p>
<a href="../../Routing.html">Routing</a> helpers such as
<tt>admin_posts_path</tt> will now be <tt>sekret_posts_path</tt>.
</p>
<dl>
<dt>:shallow_path</dt><dd>See the <tt>scope</tt> method.

</dd>
</dl>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M006176_source')" id="l_M006176_source">show</a>
                        
                        | <a href="http://github.com/rails/rails/blob/2dc297d0d74c554b9b1da86c0243afcfe95737ab/actionpack/lib/action_dispatch/routing/mapper.rb#L620" target="_blank" class="github_url">on GitHub</a>
                        
                    </p>
                    <div id="M006176_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File actionpack/lib/action_dispatch/routing/mapper.rb, line 620</span>
620:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">namespace</span>(<span class="ruby-identifier">path</span>, <span class="ruby-identifier">options</span> = {})
621:           <span class="ruby-identifier">path</span> = <span class="ruby-identifier">path</span>.<span class="ruby-identifier">to_s</span>
622:           <span class="ruby-identifier">options</span> = { <span class="ruby-identifier">:path</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">path</span>, <span class="ruby-identifier">:as</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">path</span>, <span class="ruby-identifier">:module</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">path</span>,
623:                       <span class="ruby-identifier">:shallow_path</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">path</span>, <span class="ruby-identifier">:shallow_prefix</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">path</span> }.<span class="ruby-identifier">merge!</span>(<span class="ruby-identifier">options</span>)
624:           <span class="ruby-identifier">scope</span>(<span class="ruby-identifier">options</span>) { <span class="ruby-keyword kw">yield</span> }
625:         <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M006174">
                    
                    <a name="M006174"></a><b>scope</b>(*args)
                    
                </div>
                
                <div class="description">
                  <p>
Used to scope a set of routes to particular constraints.
</p>
<p>
Take the following route definition as an example:
</p>
<pre>
  scope :path =&gt; &quot;:account_id&quot;, :as =&gt; &quot;account&quot; do
    resources :projects
  end
</pre>
<p>
This generates helpers such as <tt>account_projects_path</tt>, just like
<tt>resources</tt> does. The difference here being that the routes
generated are like /rails/projects/2, rather than
/accounts/rails/projects/2.
</p>
<h3>Supported options</h3>
<dl>
<dt>:module</dt><dd>If you want to route /posts (without the prefix /admin) to
Admin::PostsController, you could use

<pre>
  scope :module =&gt; &quot;admin&quot; do
    resources :posts
  end
</pre>
</dd>
<dt>:path</dt><dd>If you want to prefix the route, you could use

<pre>
  scope :path =&gt; &quot;/admin&quot; do
    resources :posts
  end
</pre>
<p>
This will prefix all of the <tt>posts</tt> resource&#8217;s requests with
&#8217;/admin&#8217;
</p>
</dd>
<dt>:as</dt><dd>Prefixes the routing helpers in this scope with the specified label.

<pre>
  scope :as =&gt; &quot;sekret&quot; do
    resources :posts
  end
</pre>
</dd>
</dl>
<p>
Helpers such as <tt>posts_path</tt> will now be <tt>sekret_posts_path</tt>
</p>
<p>
[:shallow_path]
</p>
<pre>
  Prefixes nested shallow routes with the specified path.

  scope :shallow_path =&gt; &quot;sekret&quot; do
    resources :posts do
      resources :comments, :shallow =&gt; true
    end

  The +comments+ resource here will have the following routes generated for it:

    post_comments    GET    /sekret/posts/:post_id/comments(.:format)
    post_comments    POST   /sekret/posts/:post_id/comments(.:format)
    new_post_comment GET    /sekret/posts/:post_id/comments/new(.:format)
    edit_comment     GET    /sekret/comments/:id/edit(.:format)
    comment          GET    /sekret/comments/:id(.:format)
    comment          PUT    /sekret/comments/:id(.:format)
    comment          DELETE /sekret/comments/:id(.:format)
</pre>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M006174_source')" id="l_M006174_source">show</a>
                        
                        | <a href="http://github.com/rails/rails/blob/2dc297d0d74c554b9b1da86c0243afcfe95737ab/actionpack/lib/action_dispatch/routing/mapper.rb#L516" target="_blank" class="github_url">on GitHub</a>
                        
                    </p>
                    <div id="M006174_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File actionpack/lib/action_dispatch/routing/mapper.rb, line 516</span>
516:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">scope</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
517:           <span class="ruby-identifier">options</span> = <span class="ruby-identifier">args</span>.<span class="ruby-identifier">extract_options!</span>
518:           <span class="ruby-identifier">options</span> = <span class="ruby-identifier">options</span>.<span class="ruby-identifier">dup</span>
519: 
520:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">name_prefix</span> = <span class="ruby-identifier">options</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">:name_prefix</span>)
521:             <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:as</span>] <span class="ruby-operator">||=</span> <span class="ruby-identifier">name_prefix</span>
522:             <span class="ruby-constant">ActiveSupport</span><span class="ruby-operator">::</span><span class="ruby-constant">Deprecation</span>.<span class="ruby-identifier">warn</span> <span class="ruby-value str">&quot;:name_prefix was deprecated in the new router syntax. Use :as instead.&quot;</span>, <span class="ruby-identifier">caller</span>
523:           <span class="ruby-keyword kw">end</span>
524: 
525:           <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:path</span>] = <span class="ruby-identifier">args</span>.<span class="ruby-identifier">first</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">args</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">String</span>)
526:           <span class="ruby-identifier">recover</span> = {}
527: 
528:           <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:constraints</span>] <span class="ruby-operator">||=</span> {}
529:           <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:constraints</span>].<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Hash</span>)
530:             <span class="ruby-identifier">block</span>, <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:constraints</span>] = <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:constraints</span>], {}
531:           <span class="ruby-keyword kw">end</span>
532: 
533:           <span class="ruby-identifier">scope_options</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">option</span><span class="ruby-operator">|</span>
534:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">value</span> = <span class="ruby-identifier">options</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">option</span>)
535:               <span class="ruby-identifier">recover</span>[<span class="ruby-identifier">option</span>] = <span class="ruby-ivar">@scope</span>[<span class="ruby-identifier">option</span>]
536:               <span class="ruby-ivar">@scope</span>[<span class="ruby-identifier">option</span>]  = <span class="ruby-identifier">send</span>(<span class="ruby-node">&quot;merge_#{option}_scope&quot;</span>, <span class="ruby-ivar">@scope</span>[<span class="ruby-identifier">option</span>], <span class="ruby-identifier">value</span>)
537:             <span class="ruby-keyword kw">end</span>
538:           <span class="ruby-keyword kw">end</span>
539: 
540:           <span class="ruby-identifier">recover</span>[<span class="ruby-identifier">:block</span>] = <span class="ruby-ivar">@scope</span>[<span class="ruby-identifier">:blocks</span>]
541:           <span class="ruby-ivar">@scope</span>[<span class="ruby-identifier">:blocks</span>] = <span class="ruby-identifier">merge_blocks_scope</span>(<span class="ruby-ivar">@scope</span>[<span class="ruby-identifier">:blocks</span>], <span class="ruby-identifier">block</span>)
542: 
543:           <span class="ruby-identifier">recover</span>[<span class="ruby-identifier">:options</span>] = <span class="ruby-ivar">@scope</span>[<span class="ruby-identifier">:options</span>]
544:           <span class="ruby-ivar">@scope</span>[<span class="ruby-identifier">:options</span>]  = <span class="ruby-identifier">merge_options_scope</span>(<span class="ruby-ivar">@scope</span>[<span class="ruby-identifier">:options</span>], <span class="ruby-identifier">options</span>)
545: 
546:           <span class="ruby-keyword kw">yield</span>
547:           <span class="ruby-keyword kw">self</span>
548:         <span class="ruby-keyword kw">ensure</span>
549:           <span class="ruby-identifier">scope_options</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">option</span><span class="ruby-operator">|</span>
550:             <span class="ruby-ivar">@scope</span>[<span class="ruby-identifier">option</span>] = <span class="ruby-identifier">recover</span>[<span class="ruby-identifier">option</span>] <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">recover</span>.<span class="ruby-identifier">has_key?</span>(<span class="ruby-identifier">option</span>)
551:           <span class="ruby-keyword kw">end</span>
552: 
553:           <span class="ruby-ivar">@scope</span>[<span class="ruby-identifier">:options</span>] = <span class="ruby-identifier">recover</span>[<span class="ruby-identifier">:options</span>]
554:           <span class="ruby-ivar">@scope</span>[<span class="ruby-identifier">:blocks</span>]  = <span class="ruby-identifier">recover</span>[<span class="ruby-identifier">:block</span>]
555:         <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
</div>
    </div>
  </body>
</html>    